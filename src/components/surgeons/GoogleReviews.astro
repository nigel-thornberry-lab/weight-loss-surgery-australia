---
/**
 * AHPRA-Compliant Google Reviews Component
 * 
 * This component displays aggregate rating data and links to Google reviews
 * WITHOUT displaying individual review content, in compliance with Section 133
 * of the Health Practitioner Regulation National Law.
 * 
 * AHPRA prohibits using testimonials about clinical aspects of regulated health
 * services in advertising. While we don't control reviews on Google Maps, displaying
 * them on our website (which promotes health services) would constitute use of
 * testimonials in advertising.
 * 
 * Compliant approach:
 * - Show aggregate ratings (factual data)
 * - Show review count (factual data)
 * - Link to Google Maps where users can read reviews
 * - Do NOT display individual review text/content
 */

const { surgeonName, surgeonSlug, rating, reviewCount } = Astro.props;

// Load slug-to-placeId mapping for Google Maps link
let slugToPlaceIdMapping = {};
try {
  const mappingData = await import('../../data/slug-to-placeid.json');
  slugToPlaceIdMapping = mappingData.default;
} catch (err) {
  console.log('No slug-to-placeId mapping found');
}

const placeId = slugToPlaceIdMapping[surgeonSlug];
const fullStars = Math.round(rating);
---

<div class="bg-white rounded-xl p-8 shadow-md border border-gray-200">
  <!-- Header -->
  <div class="text-center mb-6">
    <h2 class="text-2xl font-bold text-gray-900 mb-2">Patient Feedback</h2>
    <p class="text-gray-600">Verified reviews from Google</p>
  </div>

  <!-- Rating Display -->
  <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 mb-6">
    <div class="flex flex-col items-center justify-center gap-3">
      <!-- Star Rating -->
      <div class="flex items-center gap-1">
        {[...Array(5)].map((_, i) => (
          <svg 
            class={`w-8 h-8 ${i < fullStars ? 'text-yellow-400' : 'text-gray-300'}`} 
            fill="currentColor" 
            viewBox="0 0 20 20"
          >
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
          </svg>
        ))}
      </div>
      
      <!-- Rating Score -->
      <div class="text-center">
        <div class="text-4xl font-bold text-gray-900">{rating.toFixed(1)}</div>
        <div class="text-sm text-gray-600 mt-1">out of 5.0</div>
      </div>
      
      <!-- Review Count -->
      <div class="text-center">
        <div class="text-lg font-semibold text-gray-900">{reviewCount} Reviews</div>
        <div class="text-sm text-gray-600">Independently verified on Google</div>
      </div>
    </div>
  </div>

  <!-- Call to Action -->
  {placeId ? (
    <div class="text-center">
      <a 
        href={`https://search.google.com/local/reviews?placeid=${placeId}`}
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg"
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"/>
          <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"/>
        </svg>
        Read All Reviews on Google
      </a>
      
      <p class="text-xs text-gray-500 mt-4">
        Reviews are independently verified and hosted by Google
      </p>
    </div>
  ) : (
    <div class="text-center">
      <p class="text-gray-600 mb-4">
        See what patients are saying about {surgeonName}
      </p>
      <a 
        href={`https://www.google.com/search?q=${encodeURIComponent(surgeonName + ' reviews')}`}
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg"
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"/>
          <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"/>
        </svg>
        Search for Reviews on Google
      </a>
      
      <p class="text-xs text-gray-500 mt-4">
        Reviews are independently verified and hosted by Google
      </p>
    </div>
  )}
</div>
